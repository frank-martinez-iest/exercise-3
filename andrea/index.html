<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Exercise 3 for RockStar Engineer's Mentorships">
  <meta property="og:type" content="">
  <meta property="og:url" content="">
  <meta property="og:image" content="">

  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">

  <!-- <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;500&display=swap" rel="stylesheet"> -->

  <!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css" integrity="sha384-vp86vTRFVJgpjF9jiIGPEEqYqlDwgyBgEF109VFjmqGmIY/Y4HV4d3Gp2irVfcrp" crossorigin="anonymous"> -->
<!-- 
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/style.css"> -->

  <meta name="theme-color" content="#fafafa">
</head>

<body>
  <header>
    <nav class="navbar">
      <a class="logo" href="index.html"><i class="logo-icon fab fa-cc-mastercard fa-4x"></i></a>
      <button class="navbar-sign" id="navbar-sign" type="submit">Sign up</button>
      <button class="navbar-login" id="navbar-login" type="submit">Log in</button>
    </nav>
  </header>

  <main>
    <img class="card-img" src="img/hand_card.png" alt="hand holding a card">
    <div class="welcome-view">
      <h1 class="welcome-title">Welcome</h1>
      <p class="welcome-description">The most transparent & secure banking platform</p>
    </div>
    <h2 class="register-title" hidden>Register now</h2>
    <h2 class="login-title" hidden>Log in now</h2>
    
    <form class="register-form" action="" hidden>
        <label for="name">Username</label>
        <input type="text" id="name" placeholder="Username" data-test-id="login-username-input" required> 
        <label for="phone-number">Phone number</label>
        <input type="tel" id="phone-number" class="register-fields" placeholder="Phone Number" required>
        <label for="email">Email</label>
        <input type="email" id="email" class="register-fields" placeholder="Email" required> 
        <label for="password">Password</label>
        <input type="password" id="password" placeholder="Password" data-test-id="login-password-input" required> 
        <label for="confirm-password">Confirm password</label>
        <input type="password" id="confirm-password" class="register-fields" placeholder="Confirm Password" required>
        <button class="create-btn" type="submit">Create account</button> 
        <button class="form-alternative"> Already have an account?</button>
        <button class="login-form" hidden type="submit">Log In</</button>
    </form>
  </main>

  <script>
      // buttons //
    const signUpButton = document.querySelector("#navbar-sign");
    const logInButton = document.querySelector("#navbar-login");

    const createButton = document.querySelector(".create-btn")

    const welcomeView = document.querySelector(".welcome-view")
    let welcomeTitle = document.querySelector(".welcome-title")
    // form //
    const form = document.querySelector(".register-form");
    const registerTitle = document.querySelector(".register-title");
    const logInTitle = document.querySelector(".login-title");

    const registerFields = Array.from(document.querySelectorAll(".register-fields"));

    const logInForm = document.querySelector(".login-form");
    const formAlternative = document.querySelector(".form-alternative");

    const registerHide = [welcomeView, signUpButton, logInButton];
    const logInHide = [signUpButton, logInButton, createButton, welcomeView, formAlternative, ...registerFields];

    // passwords //
    const password = document.getElementById("password");
    const confirmPassword = document.getElementById("confirm-password");

    // change visibility
    function visibilityToggle(element){
        const elementArray = Array.isArray(element) ? element : [element]
        elementArray.forEach(element => {
            const isElementHidden = element.hasAttribute("hidden");
            isElementHidden ? element.removeAttribute("hidden") : element.setAttribute("hidden", "")
        });

    }

    // show register form //
    function showRegister() {        
        form.classList.add("form");
        visibilityToggle(registerHide);
        visibilityToggle(registerTitle);
        signUpButton.removeEventListener("click", showRegister);
    }

    signUpButton.addEventListener("click", showRegister);

    // show log in form //
    function showLogin() {
        form.classList.add("form");
        visibilityToggle(logInHide);
        visibilityToggle([logInTitle, logInForm]);
        logInButton.removeEventListener("click", showLogin);
    }

    logInButton.addEventListener("click", showLogin);
    formAlternative.addEventListener("click", showLogin);

    function welcomeUser(event){
        event.preventDefault();
        // const username = JSON.parse(localStorage.getItem("email"));
        // let password = JSON.parse(localStorage.getItem("password"));
        const username = "andrea@gmail.com";
        const password = "123";
        const formPassword =document.querySelector("#password").innerHTML
        const formUsername = document.querySelector("#name").innerHTML;
        if(formUsername ===username && formPassword===password){
            form.classList.remove("form");
            welcomeTitle.classList.add("welcome-user");
            visibilityToggle([welcomeView, logInTitle, logInForm]);
            welcomeTitle.innerHTML = "Welcome " + username;
        
        }else{
            alert("Incorrect Username or Password.")
        }
    
        logInForm.removeEventListener("click", welcomeUser);
    }

    logInForm.addEventListener("click", welcomeUser)



    // create account button //
    function createAccount(event){
        event.preventDefault();
        const credentials = {
            "email": document.querySelector("#email").value,
            "password": document.querySelector("#password").value
        };

        if (JSON.stringify(credentials.email) !== ''){
            if (JSON.stringify(credentials.email) === localStorage.getItem('email')){
                alert("already registered");
                return;
            }else{
                // local storage //
                localStorage.setItem('email', JSON.stringify(credentials.email));
                localStorage.setItem('password', JSON.stringify(credentials.password));
                showLogin();
            }
        }
        createButton.removeEventListener("click", createAccount);
    }
    createButton.addEventListener("click", createAccount);

    // validate password //

    function validatePassword(){
        if(password.value !== confirmPassword.value){
            confirmPassword.setCustomValidity("Passwords don't match");
        }else {
            confirmPassword.setCustomValidity('');
        }
    }

    password.onchange = validatePassword;
    confirmPassword.onkeyup = validatePassword;




  </script>

</body>
</html>

